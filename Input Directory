import pandas as pd

def calculate_confusion_matrix(csv_file):
    # Read the CSV file into a DataFrame
    df = pd.read_csv(csv_file)

    # Initialize dictionaries to store counts and correct classifications
    counts = {'occlusion': {'occlusion': 0, 'shadow': 0, 'texture': 0},
              'shadow': {'occlusion': 0, 'shadow': 0, 'texture': 0},
              'texture': {'occlusion': 0, 'shadow': 0, 'texture': 0}}
    correct_counts = {'occlusion': 0, 'shadow': 0, 'texture': 0}

    # Loop through each row in the DataFrame
    for index, row in df.iterrows():
        stimulus_category = row['Stimulus Category']
        observer_classification = row['Observer Classification']
        
        # Update counts
        counts[stimulus_category][observer_classification] += 1
        
        # Update correct counts
        if observer_classification == stimulus_category:
            correct_counts[stimulus_category] += 1

    # Calculate proportions
    confusion_matrix = pd.DataFrame(counts)
    confusion_matrix.index = ['occlusion', 'shadow', 'texture']
    confusion_matrix_percent = confusion_matrix.div(confusion_matrix.sum(axis=1), axis=0) * 100
    
    # Calculate percent correct
    percent_correct = {category: correct_counts[category] / confusion_matrix[category].sum() * 100 for category in correct_counts}

    return confusion_matrix_percent, percent_correct

# Example usage:
confusion_matrix, percent_correct = calculate_confusion_matrix('classification_results.csv')
print("Confusion Matrix:")
print(confusion_matrix)
print("\nPercent Correct:")
print(percent_correct)

# Ensure that the CSV file contains columns for "Stimulus Category" and "Observer Classification".
# Update the file path in the function call calculate_confusion_matrix('classification_results.csv') to point to your CSV file containing the classification results.
